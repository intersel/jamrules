<html>
	<head>
		<title>JamRules Pack Example</title>
	 	<meta charset="utf-8" />
		<script type="text/javascript" src="../extlib/jQuery/jquery-2.2.4.js"></script>
		<script type="text/javascript" src="../extlib/iFSM/extlib/jquery.dorequesttimeout.js"></script>
		<script type="text/javascript" src="../extlib/iFSM/extlib/jquery.attrchange.js"></script>
		<script type="text/javascript" src="../extlib/iFSM/iFSM.js"></script>
		<script type="text/javascript" src="../extlib/jQuery-MD5/jquery.md5.js"></script>
		<script type="text/javascript" src="../jamrules.js"></script>
	</head>
	<body>
	
	<div id="filterbox">
		<h1>Raw test of jamrules</h1>
		<div id="msg"></div>
	</div>
	<script>
	
	
	
	//initialisation of jamrules and its configurator
	var rulesEngine = new jamrules($('#filterbox'),{debug:true});
	
	// rules setting

	rulesEngine.createRulesSet("SameColorTrousoursPack",["object1","object2","object1Color","object2Color"]);
	//promo if 2 trousers bought
	rulesEngine.addRule("SameColorTrousoursPack","FirstTrouser1",'MatchPropertyValue("object1","trouser")');
	rulesEngine.addRule("SameColorTrousoursPack","FirstTrouser2",'MatchPropertyValue("object2","trouser")');
	// and have same color
	rulesEngine.addRule("SameColorTrousoursPack","SameColor1",'MatchPropertiesValue("object1Color","object1Color")');
	rulesEngine.addRule("SameColorTrousoursPack","SameColor2",'MatchPropertiesValue("object1Color","object2Color")');
	rulesEngine.addRule("SameColorTrousoursPack","SameColor3",'MatchPropertiesValue("object2Color","object1Color")');

	//promo if a trouser and a shirt
	rulesEngine.createRulesSet("TrouserShirtPack",["object1","object2"]);
	rulesEngine.addRule("TrouserShirtPack","O1Trouser",'MatchPropertyValue("object1","trouser")');
	rulesEngine.addRule("TrouserShirtPack","O2Shirt"	,'MatchPropertyValue("object2","shirt")');
	rulesEngine.createRulesSet("ShirtTrouserPack",["object1","object2"]);
	rulesEngine.addRule("ShirtTrouserPack","O1Shirt"	,'MatchPropertyValue("object1","shirt")');
	rulesEngine.addRule("ShirtTrouserPack","O2Trouser",'MatchPropertyValue("object2","trouser")');
	
	// prepare the rule engine
	rulesEngine.compileRules();
	
	var msg
	//add elements that we want to test if they match the rules
	var matched=function(){
	            msg="<p>pack has coupon</p>";
	            $("#msg").append("<pre>configuration:"+JSON.stringify(this)+"</pre>"+msg);
	}
	var notmatched=function(){
	            msg="<p>pack has no coupon</p>";
	            $("#msg").append("<pre>configuration:"+JSON.stringify(this)+"</pre>"+msg);
	}
	var pack1={
			propertiesSet:{
				object1:{trouser:1}
			,	object2:{trouser:1}
			,	object1Color:{white:1}
			,	object2Color:{white:1}
			}			
		,	matched:matched
		,	notmatched:notmatched
	};
	var pack2={propertiesSet:{
				object1:{trouser:1}
			,	object2:{shirt:1}
			,	object1Color:{white:1}
			,	object2Color:{blue:1}
			}
		,	matched:matched
		,	notmatched:notmatched
	};
	var pack3={propertiesSet:{
				object1:{shirt:1}
			,	object2:{shirt:1}
			,	object1Color:{yellow:1}
			,	object2Color:{blue:1}
			}
		,	matched:matched
		,	notmatched:notmatched
	};
	rulesEngine.addElement(pack1);
	rulesEngine.addElement(pack2);
	rulesEngine.addElement(pack3);
	
	//prepare configuration for test "2 white trousers"
	$("#msg").append("prepare configuration for test '2 white trousers'");
	rulesEngine.setProperty("object1","trouser",1,false);
	rulesEngine.setProperty("object2","trouser",1,false);
	rulesEngine.setProperty("object1Color","white",1,false);
	// will select pack1 and call its 'matched' function, 
	//will not match with pack2 and pack3 and call their 'unmatched' function
	rulesEngine.setProperty("object2Color","white",1); 

	rulesEngine.setProperty("object1","trouser",0,false);
	rulesEngine.setProperty("object2","trouser",0,false);
	rulesEngine.setProperty("object1Color","white",0,false);
	rulesEngine.setProperty("object2Color","white",0,false); 

	
	//prepare configuration "a white trousers and blue shirt"
	$("#msg").append("prepare configuration for test 'a white trousers and blue shirt'");
	rulesEngine.setProperty("object1","trouser",1,false);
	rulesEngine.setProperty("object2","shirt",1,false);
	rulesEngine.setProperty("object1Color","white",1,false);
	// will select pack2 and call its 'matched' function, 
	//will not match with pack1 and pack3 and call their 'unmatched' function
	rulesEngine.setProperty("object2Color","blue",1);

</script>
	
	</body>
    
</html>
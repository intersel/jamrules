<html>
	<head>
		<title>JamRules Pack Example</title>
	 	<meta charset="utf-8" />
		<script type="text/javascript" src="../extlib/jQuery/jquery-2.2.4.js"></script>
		<script type="text/javascript" src="../extlib/iFSM/extlib/jquery.dorequesttimeout.js"></script>
		<script type="text/javascript" src="../extlib/iFSM/extlib/jquery.attrchange.js"></script>
		<script type="text/javascript" src="../extlib/iFSM/iFSM.js"></script>
		<script type="text/javascript" src="../extlib/jQuery-MD5/jquery.md5.js"></script>
		<script type="text/javascript" src="../jamrules.js"></script>
	</head>
	<body>
	
	<div id="filterbox">
		<h1>Raw test of jamrules</h1>
		<div id="msg"></div>
	</div>
	<script>
	
	
	
	//initialisation of jamrules and its configurator
	var rulesEngineBlack = new jamrules($('#filterbox'),{debug:true});
	var rulesEngineWhite = new jamrules($('#filterbox'),{debug:true});
	var rulesEngineWin = new jamrules($('#filterbox'),{debug:true});
	
	vat nbFoundDotColor=0;
	
	// rules setting

	rulesEngineBlack.createRulesSet("blackDotColor1",["test"]);
	rulesEngineBlack.addRule("blackDotColor1","matchBlack1",'MatchProperty("dotColor1")');
	rulesEngineBlack.createRulesSet("blackDotColor2",["test"]);
	rulesEngineBlack.addRule("blackDotColor2","matchBlack2",'MatchProperty("dotColor2")');
	rulesEngineBlack.createRulesSet("blackDotColor3",["test"]);
	rulesEngineBlack.addRule("blackDotColor3","matchBlack3",'MatchProperty("dotColor3")');
	rulesEngineBlack.createRulesSet("blackDotColor4",["test"]);
	rulesEngineBlack.addRule("blackDotColor4","matchBlack4",'MatchProperty("dotColor4")');

	rulesEngineWhite.createRulesSet("whiteDotColor1",["test"]);
	rulesEngineWhite.addRule("whiteDotColor1","testWColor1",'!MatchProperty("dotColor1")');
	rulesEngineWhite.addRule("whiteDotColor1"
			,"testifWColor1"
			,'MatchExternalRule(\'this.MatchProperties("dotColor2","dotColor1")||MatchExternalRule(\'this.MatchProperties("dotColor3","dotColor1")||MatchExternalRule(\'this.MatchProperties("dotColor4","dotColor1")\')'
	);
	
	rulesEngineWhite.createRulesSet("whiteDotColor2",["test"]);
	rulesEngineWhite.addRule("whiteDotColor2","testWColor2",'!MatchProperty("dotColor2")');
	rulesEngineWhite.addRule("whiteDotColor2"
			,"testifWColor2"
			,'MatchExternalRule(\'this.MatchProperties("dotColor1","dotColor2")||MatchExternalRule(\'this.MatchProperties("dotColor3","dotColor2")||MatchExternalRule(\'this.MatchProperties("dotColor4","dotColor2")\')'
	);

	rulesEngineWhite.createRulesSet("whiteDotColor3",["test"]);
	rulesEngineWhite.addRule("whiteDotColor2","testWColor2",'!MatchProperty("dotColor2")');
	rulesEngineWhite.addRule("whiteDotColor2"
			,"testifWColor2"
			,'MatchExternalRule(\'this.MatchProperties("dotColor1","dotColor3")||MatchExternalRule(\'this.MatchProperties("dotColor2","dotColor3")||MatchExternalRule(\'this.MatchProperties("dotColor4","dotColor3")\')'
	);
	rulesEngineWhite.createRulesSet("whiteDotColor4",["test"]);
	rulesEngineWhite.addRule("whiteDotColor2","testWColor2",'!MatchProperty("dotColor2")');
	rulesEngineWhite.addRule("whiteDotColor2"
			,"testifWColor2"
			,'MatchExternalRule(\'this.MatchProperties("dotColor1","dotColor4")||MatchExternalRule(\'this.MatchProperties("dotColor2","dotColor4")||MatchExternalRule(\'this.MatchProperties("dotColor3","dotColor4")\')'
	);

			
			
	rulesEngineWin.createRulesSet("winAllColor",["test"]);
	rulesEngineBlack.addRule("winAllColor","matchBlack",'MatchProperty("dotColor1")');
	rulesEngineBlack.addRule("winAllColor","matchBlack",'MatchProperty("dotColor2")');
	rulesEngineBlack.addRule("winAllColor","matchBlack",'MatchProperty("dotColor3")');
	rulesEngineBlack.addRule("winAllColor","matchBlack",'MatchProperty("dotColor4")');

	// prepare the rule engine
	rulesEngine.compileRules();
	
	var msg;
	var nbMatch=0;
	
	//add objects that we want to test if they match the rules
	var matched=function(){
		switch(currentRules)
		{
		case 'winAllColor':
		    $("#msg").append("<h3>C'est gagn√©!!</h3><pre>"+JSON.stringify(this)+"</pre>"+msg);
			break;
		case 'whiteDotColor1':
		case 'whiteDotColor2':
		case 'whiteDotColor3':
		case 'whiteDotColor4':
		    $("#msg").append("<h3>configuration of this pack:</h3><pre>"+JSON.stringify(this)+"</pre>"+msg);
			break;
		case 'blackDotColor1':
		case 'blackDotColor2':
		case 'blackDotColor3':
		case 'blackDotColor4':
			break;
		}
	}
	var notmatched=function(){
	            msg="<p style='color:red'>This pack is not selected or has no coupon</p>";
	            $("#msg").append("<h3>configuration of this pack:</h3><pre>"+JSON.stringify(this)+"</pre>"+msg);
	}
	var pack1={
			propertiesSet:{
				object1:{trouser:1}
			,	object2:{trouser:1}
			,	object1Color:{white:1}
			,	object2Color:{white:1}
			}			
		,	matched:matched
		,	notmatched:notmatched
	};
	var pack2={propertiesSet:{
				object1:{trouser:1}
			,	object2:{shirt:1}
			,	object1Color:{white:1}
			,	object2Color:{blue:1}
			}
		,	matched:matched
		,	notmatched:notmatched
	};
	var pack3={propertiesSet:{
				object1:{shirt:1}
			,	object2:{shirt:1}
			,	object1Color:{yellow:1}
			,	object2Color:{blue:1}
			}
		,	matched:matched
		,	notmatched:notmatched
	};
	var pack4={propertiesSet:{
				object1:{shirt:1}
			,	object2:{trouser:1}
			,	object1Color:{white:1}
			,	object2Color:{white:1}
			}
		,	matched:matched
		,	notmatched:notmatched
	};
	rulesEngine.addObject(pack1);
	rulesEngine.addObject(pack2);
	rulesEngine.addObject(pack3);
	rulesEngine.addObject(pack4);
	
	//
	$("#msg").append("<h2>prepare configuration to get the pack with object1 being a trouser</h2>");
	rulesEngine.selectConfigurationPropertyValue("object1","trouser",1);
    $("#msg").append("<h3>configuration of the configurator:</h3><pre>"+JSON.stringify(rulesEngine.propertiesConfiguration)+"</pre>");

	//reinit the configurator
	rulesEngine.selectConfigurationPropertyValue("object1","trouser",0,false);
	
	//
	$("#msg").append("<h2>prepare configuration to get pack with object2 being a trouser</h2>");
	rulesEngine.selectConfigurationPropertyValue("object2","trouser",1);
    $("#msg").append("<h3>configuration of the configurator:</h3><pre>"+JSON.stringify(rulesEngine.propertiesConfiguration)+"</pre>");

</script>
	
	</body>
    
</html>

<html>
	<head>
		<title>testJamRules</title>
	 	<meta charset="utf-8" />
		<script type="text/javascript" src="../extlib/jQuery/jquery-2.2.4.js"></script>
		<script type="text/javascript" src="../extlib/iFSM/extlib/jquery.dorequesttimeout.js"></script>
		<script type="text/javascript" src="../extlib/iFSM/extlib/jquery.attrchange.js"></script>
		<script type="text/javascript" src="../extlib/iFSM/iFSM.js"></script>
		<script type="text/javascript" src="../extlib/jQuery-MD5.jquery.md5.js))"></script>
		<script type="text/javascript" src="../jamrules.js"></script>
	</head>
	<body>
	<section id="filterbox">
		<h1>Filter box</h1>
		<section id='priority'>
			<label>
				<input class="checkbox" id="priority-un" type="checkbox" value="priority1">
				Priority 1
			</label>
			<label>
				<input class="checkbox" id="priority-deux" type="checkbox" value="priority2">
				Priority 2
			</label>

		</section>
		<section id='technician'>
			<label>
				<input class="checkbox" id="priority-un" type="checkbox" value="technician1">
				Priority 1
			</label>
			<label>
				<input class="checkbox" id="priority-deux" type="checkbox" value="technician2">
				Priority 2
			</label>

		</section>
		<label>
			<input class="checkbox" id="display-on" type="checkbox" value="display.on">
			Display Priority
		</label>
		<label>
			<input class="checkbox" id="compliant-on" type="checkbox" value="compliant.on">
			Technician Compliant
		</label>
	</section> 
	<section id="element1">
		<h1>El√©ment 1</h1>
		<section id='priority' class="property">
			<label>
				<input class="checkbox" id="el1-priority-un" type="checkbox" value="priority1" checked>
				Priority 1
			</label>
			<label>
				<input class="checkbox" id="el1-priority-deux" type="checkbox" value="priority2">
				Priority 2
			</label>
		</section>
		<section id='compliantTechnician' class='property'>
			<label>
				<input class="checkbox" id="el1-technician1-compliant" type="checkbox" value="technician1" checked>
				Technician 1 Compliant
			</label>
			<label>
				<input class="checkbox" id="el1-technician2-compliant" type="checkbox" value="technician2">
				Technician 2 Compliant
			</label>
		</section>
	</section>
	<section id="result">
		<h1>Result Matching</h1>
		<label>
			<input class="checkbox" id="el1-match" type="checkbox"  disabled>
			Element 1 match?
		</label>
		<label>
			<input class="checkbox" id="el2-match" type="checkbox" disabled>
			Element 2 match?
		</label>
		<div id="debug">
		</div>
	</section>

	<script>
	var rulesForPriorityLayer = new jamrules($('#filterbox'));
	rulesForPriorityLayer.setProperty("priority","priority1",0)
	rulesForPriorityLayer.setProperty("priority","priority2",0)
	rulesForPriorityLayer.setProperty("compliantTechnician","technician1",0)
	rulesForPriorityLayer.setProperty("compliantTechnician","technician2",0)

	rulesForPriorityLayer.addRule("Priority1Match","priority",'MatchPropertyName("priority")');
	 
	var el1={propertiesSet:{priority:{},compliantTechnician:{}},matched:null,notmatched:null};
	el1['propertiesSet']['priority']['priority1']=$("#el1-priority-un").prop('checked');
	el1['propertiesSet']['priority']['priority2']=$("#el1-priority-deux").prop('checked');
	el1['propertiesSet']['compliantTechnician']['technician1']=$("#el1-technician1-compliant").prop('checked');
	el1['propertiesSet']['compliantTechnician']['technician2']=$("#el1-technician2-compliant").prop('checked');
			
	 
	rulesForPriorityLayer.addElement(el1);
	
	var checkBoxFilterFSM = {
            DefaultState        :
            {
    	        click   :   
    	        {
                    init_function: function(){
                    	this.opts
                    	.filterBoxes
                    	.trigger('filterChange',{
    							 who:this.myUIObject
    							,propertyName:this.myUIObject.parent().parent().attr('id')
    							,propertyValue:this.myUIObject.attr('value')
    							,status:this.myUIObject.prop('checked')
    							,ruleEngine:this.opts.ruleEngine
    					});
                    },
                    UI_event_bubble:true,
    	        }
            }
        };
    var filterBoxesFSM = {
            DefaultState        :
            {
            	filterChange   :   
    	        {
                    init_function: function(data,aEvent,dataFromCheckbox){
                    	$("#debug").html("who:"+dataFromCheckbox.who.attr('id')+"<br>propertyName:"+dataFromCheckbox.propertyName+"<br>propertyValue:"+dataFromCheckbox.propertyValue+"<br>status:"+dataFromCheckbox.status);
                    	this.opts.ruleEngine.setProperty(dataFromCheckbox.propertyName,dataFromCheckbox.propertyValue,dataFromCheckbox.status);
                    }
    	        }
            }
        };

	$(document).ready(function() {
		$('#filterbox').iFSM(filterBoxesFSM);
		$('#filterbox input.checkbox').iFSM(checkBoxFilterFSM,{filterBoxes:$('#filterbox'),ruleEngine:rulesForPriorityLayer});
	});

    </script>
	
	</body>
    
</html>